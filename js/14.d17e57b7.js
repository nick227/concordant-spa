(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{d0ea:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"river-width",attrs:{padding:""}},[a("q-btn",{staticClass:"full-width",attrs:{label:"Create Treaty"},on:{click:function(e){return t.openCreateTreaty()}}}),a("q-list",{attrs:{padding:""}},[t._l(t.treaties,(function(t){return a("div",{key:t.id},[a("TreatyCardComponent",{attrs:{treaty:t}})],1)})),t.treaties.length||t.done?t._e():a("h3",{staticClass:"q-ma-lg text-center"},[t._v("LOADING...")]),!t.treaties.length&&t.done?a("h3",{staticClass:"q-ma-lg text-center"},[t._v("No treaties found.")]):t._e(),t.done?t._e():a("div",{directives:[{name:"intersection",rawName:"v-intersection",value:t.onIntersection,expression:"onIntersection"}],staticClass:"full-width text-center"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)],2),a("q-dialog",{model:{value:t.createTreaty,callback:function(e){t.createTreaty=e},expression:"createTreaty"}},[a("CreateTreaty",{staticClass:"z-top",attrs:{userOrganizationId:!1,conflictId:!1,reload:t.reload}})],1)],1)},r=[],n=(a("e01a"),a("c973")),s=a.n(n),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-item",{staticClass:"full-width q-mb-lg"},[a("q-card",{staticClass:"full-width"},[a("div",{staticClass:"text-h4 q-pa-md"},[t._v(t._s(t.treaty.name))]),a("q-img",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"cursor-pointer",attrs:{clickable:"",src:t.treaty.avatar_url},on:{click:function(e){return t.goto("/treaty/"+t.treaty.id)}}}),a("div",{staticClass:"q-pl-md bg-grey-3"},[t._v(t._s(t.treaty.organization_a.name)+" vs. "+t._s(t.treaty.organization_b.name))]),a("q-card-section",[a("q-btn",{staticClass:"float-right text-black",attrs:{align:"around",color:"white",label:"Visit",icon:"launch"},on:{click:function(e){return t.goto("/treaty/"+t.treaty.id)}}}),a("div",{staticClass:"caption"},[t._v("Created by: "+t._s(t.treaty.creator_name))]),a("div",[t._v("Organization: "+t._s(t.treaty.creator_organization_name))]),a("q-separator",{staticClass:"q-mt-sm q-mb-sm"}),a("p",{staticClass:"q-pa-none"},[t._v(t._s(t.treaty.description))]),a("q-separator",{staticClass:"q-mt-sm q-mb-sm"}),a("div",{staticClass:"row"},[a("div",{staticClass:"col"},[t._v("Yay: "+t._s(t.treaty.yay_votes)+" Nay: "+t._s(t.treaty.nay_votes))]),a("div",{staticClass:"col text-right"},[t._v("Rated "+t._s(t.treaty.rating)+"/5")])])],1),t.treaty.provisions?a("q-expansion-item",{staticClass:"bg-blue-grey-5",attrs:{"switch-toggle-side":"","dense-toggle":"",label:"Provisions "+t.treaty.provisions.length}},t._l(t.treaty.provisions,(function(e,i){return a("div",{key:e.id,staticClass:"q-pl-lg q-pt-sm q-pr-lg q-pb-sm"},[a("q-badge",{staticClass:"q-mr-sm",attrs:{color:"grey"}},[t._v(t._s(i+1))]),t._v(" "+t._s(e.title))],1)})),0):t._e()],1)],1)},l=[],c={name:"TreatyCardComponent",props:["treaty"],components:{},data(){return{}},methods:{goto:function(t){this.$router.push({path:t})}},mounted(){}},d=c,u=a("2877"),p=Object(u["a"])(d,o,l,!1,null,null,null),v=p.exports,m=a("95fb"),_={meta(){return{title:"Treaties"}},name:"ListTreatyPage",components:{CreateTreaty:m["a"],TreatyCardComponent:v},data(){return{treaties:[],pointer:0,limit:2,done:!1,loadNum:0,createTreaty:!1}},methods:{openCreateTreaty:function(){this.$errorHandler.loggedInCheck()&&(this.createTreaty=!0)},loadTreaties:function(){var t=s()((function*(){const t=`https://concordant-api.herokuapp.com/treaties?filter={"skip":${this.pointer},\n                                                     "limit":${this.limit}, \n                                                     "order":["create_date DESC"], \n                                                     "include": [{"relation": "organization"}, \n                                                                 {"relation":"creator"}, \n                                                                 {"relation":"votes"}, \n                                                                 {"relation": "ratings"}, \n                                                                 {"relation": "provisions"}, \n                                                                 {"relation": "conflict", "scope":{"include":[\n                                                                                           {"relation":"organization_a"}, \n                                                                                           {"relation":"organization_b"}]}}]}`,e=yield this.$axios.get(t);this.limit>e.data.length&&(this.done=!0);const a=e.data.map(t=>({id:t.id,name:t.name,description:t.description,avatar_url:t.avatar_url,creator_name:t.creator.name,creator_organization_name:t.organization.name,conflict_id:t.conflict.id,organization_a:t.conflict.organization_a,organization_b:t.conflict.organization_b,grievances:t.conflict.grievances,offers:t.conflict.offers,yay_votes:t.votes?t.votes.filter((function(t){return 1===t.vote_type})).reduce((t,e)=>t+e.vote_type,0):0,nay_votes:t.votes?t.votes.filter((function(t){return 0===t.vote_type})).reduce((t,e)=>t+e.vote_type,0):0,votes:t.votes,provisions:t.provisions,rating:t.ratings?Math.round(t.ratings.reduce((t,e)=>t+e.value,0)/t.ratings.length):0}));this.treaties=this.treaties.concat(a)}));return function(){return t.apply(this,arguments)}}(),reload:function(){this.treaties=[],this.loadTreaties(),this.createTreaty=!1},onIntersection:function(t,e){this.loadNum>1&&(this.pointer=this.pointer+this.limit,this.loadTreaties()),this.loadNum++}},created(){var t=this;return s()((function*(){t.loadTreaties()}))()},mounted(){}},g=_,y=Object(u["a"])(g,i,r,!1,null,null,null);e["default"]=y.exports}}]);