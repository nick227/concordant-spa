(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{"295b":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"row full-width q-pa-sm bg-grey-2"},[i("div",{staticClass:"col col-md-5"},[i("a",{staticClass:"cursor-pointer",on:{click:function(e){return t.$router.push("/organization/"+t.org_a.id)}}},[i("q-avatar",{attrs:{size:"40px",square:""}},[i("q-img",{staticClass:"q-mt-none",attrs:{rounded:"",src:t.org_a.avatar_url}})],1),i("br"),t._v("\n          "+t._s(t.org_a.name)+"\n      ")],1)]),i("div",{staticClass:"col col-md-2 text-center q-pt-md"},[t._v("\n      vs.\n    ")]),i("div",{staticClass:"col col-md-5 text-right"},[i("a",{staticClass:"cursor-pointer",on:{click:function(e){return t.$router.push("/organization/"+t.org_b.id)}}},[i("q-avatar",{attrs:{size:"40px",square:""}},[i("q-img",{staticClass:"q-mt-none",attrs:{rounded:"",src:t.org_b.avatar_url}})],1),i("br"),t._v("\n          "+t._s(t.org_b.name)+"\n      ")],1)])]),t.loading?t._e():i("q-page-container",{staticClass:"river-width"},[i("q-page",{attrs:{padding:""}},[t.isUser?i("div",{staticClass:"row relative-position q-mb-sm full-width",staticStyle:{height:"35px"}},[i("q-expansion-item",{staticClass:"z-top",attrs:{"switch-toggle-side":"","dense-toggle":"",label:"Edit Treaty"},model:{value:t.editExpanded,callback:function(e){t.editExpanded=e},expression:"editExpanded"}},[i("EditTreatyWidget",{key:"edit"+t.counter,attrs:{name:t.treaty.name,description:t.treaty.description,avatarUrl:t.treaty.avatar_url,provisions:t.provisions,reload:t.getTreaty,id:t.treaty.id}})],1)],1):t._e(),i("RatingWidget",{attrs:{readonly:!t.userOrganizationId,entityId:t.treaty.id,userOrganizationId:t.userOrganizationId,entityType:"treaty"}}),i("div",{staticClass:"row"},[i("div",{staticClass:"col col-3"},[i("q-img",{attrs:{src:t.treaty.avatar_url}})],1),i("div",{staticClass:"col q-pl-md"},[i("div",{},[i("router-link",{attrs:{to:"/conflict/"+t.treaty.conflict.id}},[t._v(t._s(t.org_a.name)+" vs. "+t._s(t.org_b.name))])],1),i("h4",{staticClass:"q-pa-none"},[t._v(t._s(t.treaty.name))]),i("p",{staticClass:"q-pt-none"},[t._v(t._s(t.treaty.description))]),t.treaty.creator?i("p",{staticClass:"caption q-pt-none"},[t._v("Created by: "),i("router-link",{attrs:{to:"/profile/"+t.treaty.creator.id}},[t._v(t._s(t.treaty.creator.name))])],1):t._e()])]),i("q-separator",{staticClass:"q-mt-md"}),t.provisions.length?i("h5",[t._v("Provisions:")]):t._e(),i("q-separator",{staticClass:"q-mb-md"}),t.isUser?i("q-expansion-item",{staticClass:"full-width q-mb-sm bg-blue-grey-1",attrs:{label:"Add Provision"},model:{value:t.expanded,callback:function(e){t.expanded=e},expression:"expanded"}},[i("AddProvision",{attrs:{id:t.treaty.id,numProvisions:t.numProvisions,reload:t.loadProvisions}})],1):t._e(),i("q-list",{staticClass:"full-width"},t._l(t.provisions,(function(e,a){return i("div",{key:e.id,staticClass:"full-width q-mb-sm"},[i("TreatyProvisionComponent",{attrs:{provision:e,index:a,userOrganizationId:t.userOrganizationId,creatorId:t.treaty.creator.id}})],1)})),0),t.userOrganizationId?i("TreatyVoteWidget",{key:"votesw"+t.counter,staticClass:"q-mt-lg q-mb-sm",attrs:{reload:t.getVotes,votes:t.votes,id:t.treaty.id,userOrganizationId:t.userOrganizationId}}):t._e(),i("q-separator",{staticClass:"q-mt-md"}),i("h5",[t._v("Votes:")]),i("q-separator",{staticClass:"q-mb-md"}),i("TreatyVotesTable",{key:"votest"+t.counter,attrs:{reload:t.getVotes,votes:t.votes,id:t.treaty.id}}),t.userOrganizationId?i("CommentsWidget",{attrs:{entityId:t.treaty.id,entityType:"treaty"}}):t._e(),i("q-dialog",{attrs:{persistent:""},model:{value:t.verify_org,callback:function(e){t.verify_org=e},expression:"verify_org"}},[i("q-card",[i("q-card-section",{staticClass:"row items-center"},[i("q-avatar",{attrs:{icon:"done_outline",color:"primary","text-color":"white"}}),i("span",{staticClass:"q-ml-sm"},[t._v("Choose ONE organization to comment as.")])],1),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:t.org_a.name,color:"primary"},on:{click:function(e){return t.setOrg(t.org_a)}}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:t.org_b.name,color:"primary"},on:{click:function(e){return t.setOrg(t.org_b)}}})],1)],1)],1),i("RelatedTreatiesWidget",{attrs:{conflictId:t.treaty.conflict.id,currentId:t.treaty.id}})],1)],1)],1)},r=[],s=i("c973"),o=i.n(s),n=i("21e4"),l=i("9088"),d=i("ec09"),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.links.length?i("div",{staticClass:"text-left river-width q-mt-lg"},[i("q-separator",{staticClass:"q-mt-md"}),i("h5",[t._v("Related treaties:")]),i("q-separator",{staticClass:"q-mb-md"}),t._l(t.links,(function(e){return i("a",{key:e.id,staticClass:"cursor-pointer",attrs:{replace:""},on:{click:function(i){return t.goto(e.url)}}},[t._v(t._s(e.text))])}))],2):t._e()},u=[],p={name:"RelatedTreatiesWidget",props:["conflictId","currentId"],data(){return{treaties:[],limit:5}},computed:{links:function(){return this.treaties.map(t=>({url:"/treaty/"+t.id,text:t.name,id:t.id}))}},methods:{goto:function(t){window.location.href=t},getUrls:function(){var t=o()((function*(){const t=`https://concordant-api.herokuapp.com/treaties?filter[where][and][0][conflict_id]=${this.conflictId}&filter[where][and][1][id][neq]=${this.currentId}&filter[fields][id]=true&filter[fields][name]=true&filter[limit]=${this.limit}`,e=yield this.$axios.get(t);this.treaties=e.data}));return function(){return t.apply(this,arguments)}}()},created(){this.getUrls()},beforeRouteUpdate(t,e,i){console.log(t),i()}},g=p,m=i("2877"),h=Object(m["a"])(g,c,u,!1,null,null,null),v=h.exports,f=i("a9cd"),y=i("5f68"),_=i("7b0ba"),b=i("65d1"),q={name:"TreatyPage",meta(){return{title:this.treaty.name}},props:[],components:{AddProvision:f["a"],CommentsWidget:l["a"],TreatyVoteWidget:y["a"],RatingWidget:n["a"],TreatyVotesTable:_["a"],EditTreatyWidget:d["a"],TreatyProvisionComponent:b["a"],RelatedTreatiesWidget:v},data(){return{userOrganizationId:null,creatorName:null,creatorId:null,counter:0,editExpanded:!1,expanded:!1,provisions:[],columns:[],numProvisions:0,isUser:!1,votes:[],treaty:{},loading:!0,verify_org:!1,org_a:{},org_b:{},initialPagination:{sortBy:"desc",descending:!1,page:1,rowsPerPage:10}}},methods:{getTreaty:function(){var t=o()((function*(){this.editExpanded=this.expanded=!1;const t=`https://concordant-api.herokuapp.com/treaties/${this.$route.params.id}?filter={"include":[{"relation":"creator"},{"relation":"conflict", "scope":{"include":[{"relation":"organization_a"},{"relation":"organization_b"}]}}]}`,e=yield this.$axios.get(t);this.treaty=e.data,this.org_a=this.treaty.conflict.organization_a,this.org_b=this.treaty.conflict.organization_b,this.getUserOrg(),this.getVotes(),this.loadProvisions(),this.setupTable(),this.isUser=this.$errorHandler.isLoggedInUser(this.treaty.creator_user_id),this.loading=!1}));return function(){return t.apply(this,arguments)}}(),setOrg:function(t){this.userOrganizationName=t.name,this.userOrganizationId=t.id,this.reload()},getUserOrg:function(){var t=o()((function*(){const t=`https://concordant-api.herokuapp.com/user-to-organizations?filter[where][and][0][creator_user_id]=${this.$store.state.user.uid}&filter[where][or][1][organization_id]=${this.org_a.id}&filter[where][or][2][organization_id]=${this.org_b.id}`,e=yield this.$axios.get(t);this.joined=e.data,this.joined.length>1&&(this.verify_org=!0),1===this.joined.length&&(this.userOrganizationId=this.joined[0].organization_id,this.userOrganizationName=this.joined[0].name),0===this.joined.length&&this.$q.notify({type:"info",message:"Please join organization to comment"})}));return function(){return t.apply(this,arguments)}}(),setupTable:function(){this.columns=[{name:"position",align:"left",label:"Position",field:"position",sortable:!0,style:"width:55px;"},{name:"title",align:"left",label:"Title",field:"title",sortable:!0},{name:"description",align:"left",label:"Description",field:"description",sortable:!0}]},getVotes:function(){var t=o()((function*(){const t=`https://concordant-api.herokuapp.com/votes?filter[where][treaty_id]=${this.$route.params.id}&filter[include][0][relation]=creator&filter[include][1][relation]=organization&filter[order]=create_date%20DESC`,e=yield this.$axios.get(t);this.votes=e.data.map(t=>({creatorUserId:t.creator_user_id,date:t.create_date,name:t.creator.name,location:t.creator.location,organization:t.organization.name,vote:t.vote_type,sortable:!0})),this.counter=this.counter+1}));return function(){return t.apply(this,arguments)}}(),loadProvisions:function(){var t=o()((function*(){this.editExpanded=this.expanded=!1;const t=`https://concordant-api.herokuapp.com/treaty-provisions?filter[where][treaty_id]=${this.$route.params.id}&filter[order]=position%20ASC`,e=yield this.$axios.get(t);this.provisions=e.data,this.numProvisions=this.provisions.length?this.provisions.length:0}));return function(){return t.apply(this,arguments)}}()},created(){this.getTreaty()}},C=q,x=Object(m["a"])(C,a,r,!1,null,null,null);e["default"]=x.exports}}]);