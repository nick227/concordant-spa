(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"0b3a":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{staticClass:"q-pa-none text-left river-width"},[t.messages.length?s("h3",{staticClass:"full-width text-left bg-secondary q-pl-lg"},[t._v("Messages")]):t._e(),t.messages.length?t._e():s("h4",{staticClass:"full-width text-left bg-secondary q-pl-lg"},[t._v("Inbox is empty.")]),s("transition",{attrs:{appear:"","enter-active-class":"animated fadeIn"}},[s("q-list",t._l(t.messages,(function(e){return s("div",{key:e.id,staticClass:"row q-pa-lg",class:{unread:e.status},staticStyle:{"border-bottom":"1px solid lightgrey"}},[s("div",{staticClass:"col col-1"},[s("q-img",{attrs:{src:e.creator_avatar}})],1),s("div",{staticClass:"col q-pl-lg q-pr-sm q-pb-lg"},[s("h6",{staticClass:"q-pa-none"},[t._v(t._s(e.creator_name))]),s("p",{staticClass:"q-pa-none"},[t._v(t._s(e.create_date))]),s("div",{staticClass:"q-pt-sm"},[s("span",[t._v(t._s(e.text))]),e.hidden_text&&e.show_more?s("span",[t._v(t._s(e.hidden_text))]):t._e()]),e.hidden_text&&!e.show_more?s("q-btn",{staticClass:"q-mt-md text-black",on:{click:function(t){e.show_more=!0}}},[t._v("show more")]):t._e(),e.hidden_text&&e.show_more?s("q-btn",{staticClass:"q-mt-md",on:{click:function(t){e.show_more=!1}}},[t._v("hide")]):t._e()],1),s("div",{staticClass:"col col-1 text-right align-right flex-right"},[s("q-btn",{staticStyle:{width:"36px",height:"30px"},attrs:{color:"grey",icon:"delete",square:"",size:"11px"},on:{click:function(s){return t.deleteMsg(e.id)}}})],1)])})),0)],1)],1)},i=[],n=s("c973"),r=s.n(n),o={meta(){return{title:"Messages"}},name:"MessagesPage",components:{},data(){return{messages:[]}},methods:{deleteMsg:function(){var t=r()((function*(t){const e="http://72.177.0.66:3000//user-messages/"+t,s={id:t,status:2};yield this.$axios.patch(e,s).then(t=>{this.loadMessages(),this.$q.notify({type:"positive",message:"Update Success"})}).catch(t=>{this.$q.notify({type:"negative",message:"Error Deleting: "+t})})}));return function(e){return t.apply(this,arguments)}}(),loadMessages:function(){var t=r()((function*(){const t=`http://72.177.0.66:3000//user-messages?filter[where][and][0][user_id]=${this.$store.state.user.uid}&filter[where][and][1][status][lt]=2&filter[include][][relation]=creator&filter[order]=create_date%20DESC`,e=yield this.$axios.get(t);this.messages=e.data.map(t=>{const e=this.trunc(t.text);return{creator_avatar:t.creator.avatar_url,creator_name:t.creator.name,text:e[0],id:t.id,status:t.status,create_date:t.create_date,hidden_text:e[1],show_more:!1}}),this.markRead()}));return function(){return t.apply(this,arguments)}}(),trunc:function(t){const e=[],s=350;if(t.length>s){let a=!1,i=s;while(i<t.length&&!a)a=" "===t[i]&&i,i++;e[0]=t.substring(0,a),e[1]=t.substring(a,t.length)}else e[0]=t,e[1]="";return e},markRead:function(){var t=r()((function*(){const t="http://72.177.0.66:3000//user-messages";for(let e=0;e<this.messages.length;e++)if(0===this.messages[e].status){const s={id:this.messages[e].id,status:1};yield this.$axios.patch(t,s).catch(t=>{this.$q.notify({type:"negative",message:"Error Marking Read: "+t})})}this.$store.commit("user/updateMsgCount",0)}));return function(){return t.apply(this,arguments)}}()},created(){this.loadMessages()}},c=o,l=(s("843e"),s("2877")),d=Object(l["a"])(c,a,i,!1,null,null,null);e["default"]=d.exports},"843e":function(t,e,s){"use strict";var a=s("e4a4"),i=s.n(a);i.a},e4a4:function(t,e,s){}}]);